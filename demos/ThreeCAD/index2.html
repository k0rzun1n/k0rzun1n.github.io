<!DOCTYPE html>
<html lang="en">

<head>
	<title>three.js webgl - loaders - 3DS loader</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			font-family: Monospace;
			background-color: #000;
			color: #fff;
			margin: 0px;
			overflow: hidden;
		}

		#info {
			color: #fff;
			position: absolute;
			top: 10px;
			width: 100%;
			text-align: center;
			z-index: 100;
			display: block;
		}

		#info a,
		.button {
			color: #f00;
			font-weight: bold;
			text-decoration: underline;
			cursor: pointer
		}
	</style>
	<script id="vertex-shader" type="x-shader/x-vertex">
		varying vec2 vUv;
		void main()
		{
			vUv = uv;
			vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * mvPosition;
		}
		</script>
	<script id="fragment-shader" type="x-shader/x-fragment">
		varying vec2 vUv;
		
		void main() {
			gl_FragColor = vec4(vUv, 0.0, 1.0);
		}
	</script>
</head>

<body>
	<div id="info">
		<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - 3DS loader
	</div>

	<script src="three.min.js"></script>
	<script src="OrbitControls.js"></script>
	<script src="TDSLoader.js"></script>

	<script>

		var container, controls;
		var camera, scene, renderer;

		init();
		animate();

		function init() {

			container = document.createElement('div');
			document.body.appendChild(container);

			camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 5, 2000);
			camera.position.z = 700;
			camera.position.y = 150;
			// camera.position.x = 300;

			controls = new THREE.OrbitControls(camera);
			controls.target = new THREE.Vector3(0, 150, 0);
			controls.rotateSpeed = 0.2;

			scene = new THREE.Scene();
			scene.add(new THREE.HemisphereLight());

			var directionalLight = new THREE.DirectionalLight(0xffeedd);
			directionalLight.position.set(0, 3, 2);
			scene.add(directionalLight);

			//3ds files dont store normal maps
			var loader = new THREE.TextureLoader();
			var normal = loader.load('portalgun/textures/normal.jpg');

			var loader = new THREE.TDSLoader();
			loader.setPath('portalgun/textures/');
			// loader.load( 'portalgun/portalgun.3ds', function ( object ) {
			loader.load('mylathe.3ds', function (object) {

				var shMat = new THREE.ShaderMaterial({
					vertexShader: document.getElementById('vertex-shader').textContent,
					fragmentShader: document.getElementById('fragment-shader').textContent,
					// depthWrite: false,
					// depthTest: false
				})
				object.traverse(function (child) {

					if (child instanceof THREE.Mesh) {

						child.material = shMat;
					}

				});
				object.rotateX(-Math.PI / 2);
				scene.add(object);

			});



			renderer = new THREE.WebGLRenderer();
			renderer.setClearColor(0x003333, 1);
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			container.appendChild(renderer.domElement);

			window.addEventListener('resize', resize, false);

		}

		function resize() {

			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();

			renderer.setSize(window.innerWidth, window.innerHeight);

		}

		function animate() {

			controls.update();
			renderer.render(scene, camera);

			requestAnimationFrame(animate);

		}
	</script>

</body>

</html>